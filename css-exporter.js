/**
 * CSS Exporter Module
 * Generate CSS for border-image and pseudo-elements.
 */

/**
 * Generate CSS for border-image and pseudo-elements.
 *
 * @param {ProcessedComponent[]} components - Extracted components
 * @param {string} imageBasePath - Base path for image URLs
 * @returns {string} - CSS stylesheet content
 */
export function exportToCSS(components, imageBasePath = 'images/') {
  const cssBlocks = [];

  // Header comment
  cssBlocks.push(`/**
 * Nine-Slice UI Components
 * Generated by Image Grid Analyzer
 * ${new Date().toISOString()}
 */
`);

  // CSS custom properties for easy theming
  cssBlocks.push(`:root {
  --nine-slice-base-path: '${imageBasePath}';
}
`);

  for (const component of components) {
    const className = `ui-${component.name}`;
    const imagePath = `${imageBasePath}${component.name}.png`;

    // Main border-image style
    if (component.nineSlice) {
      const { top, right, bottom, left } = component.nineSlice;

      cssBlocks.push(`/* Component: ${component.name} */
.${className} {
  border-width: ${top}px ${right}px ${bottom}px ${left}px;
  border-style: solid;
  border-color: transparent;
  border-image-source: url('${imagePath}');
  border-image-slice: ${top} ${right} ${bottom} ${left} fill;
  border-image-repeat: round;
  box-sizing: border-box;
}

.${className}--stretch {
  border-image-repeat: stretch;
}

.${className}--repeat {
  border-image-repeat: repeat;
}

.${className}--space {
  border-image-repeat: space;
}
`);
    }

    // Pseudo-element variants for more control
    cssBlocks.push(`.${className}-pseudo {
  position: relative;
  z-index: 1;
}

.${className}-pseudo::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: url('${imagePath}');
  background-size: 100% 100%;
  background-repeat: no-repeat;
  pointer-events: none;
  z-index: -1;
}
`);

    // Corner-only variant using ::before and ::after
    if (component.nineSlice) {
      const { top, left, right, bottom } = component.nineSlice;

      cssBlocks.push(`.${className}-corners {
  position: relative;
}

.${className}-corners::before,
.${className}-corners::after {
  content: '';
  position: absolute;
  background-image: url('${imagePath}');
  background-repeat: no-repeat;
  pointer-events: none;
}

/* Top-left corner */
.${className}-corners::before {
  top: 0;
  left: 0;
  width: ${left}px;
  height: ${top}px;
  background-position: 0 0;
}

/* Additional corners require extra elements or CSS Grid */
`);
    }

    // Utility class for dynamic sizing
    cssBlocks.push(`.${className}--fluid {
  min-width: ${component.nineSlice ? component.nineSlice.left + component.nineSlice.right : 0}px;
  min-height: ${component.nineSlice ? component.nineSlice.top + component.nineSlice.bottom : 0}px;
}
`);
  }

  return cssBlocks.join('\n');
}
